{% extends "layout.html" %}

{% block title %}Manage Email Templates{% endblock %}

{% block content %}
<style>
    .page-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 1em; margin-bottom: 1.5em; }
    .page-header h2 { margin: 0; }
    .template-item { border-bottom: 1px solid #eee; padding-bottom: 1.5em; margin-bottom: 1.5em; }
    .template-item:last-child { border-bottom: none; margin-bottom: 0; }
    .template-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1em; }
    .template-header h4 { margin: 0; }
    .template-body { border: 1px solid #eee; padding: 15px; border-radius: 8px; background: #f9f9f9; max-height: 200px; overflow-y: auto; }
    .actions { display: flex; gap: 10px; }
    .actions form { margin: 0; }
    .button { color: white; padding: 8px 15px; text-decoration: none; border-radius: 5px; border: none; font-size: 14px; cursor: pointer; display: inline-block; }
    .button.primary { background-color: #007bff; }
    .button.primary:hover { background-color: #0056b3; }
    .button.secondary { background-color: #6c757d; }
    .button.secondary:hover { background-color: #5a6268; }
    .button.danger { background-color: #dc3545; }
    .button.danger:hover { background-color: #c82333; }
</style>

<div class="page-header">
    <h2>Manage Email Templates</h2>
    <a href="{{ url_for('template_manager.new_template_form') }}" class="button primary">+ Add New Template</a>
</div>

{% for template in templates %}
    <div class="template-item">
        <div class="template-header">
            <h4>
                {{ template.subject }}
                {% if template.is_default %}
                    <span style="font-weight: normal; font-size: 0.8em; color: #6c757d;">(Default)</span>
                {% endif %}
            </h4>
            <div class="actions">
                <a href="{{ url_for('template_manager.edit_template_form', template_id=template.id) }}" class="button secondary">Edit</a>

                {% if not template.is_default %}
                    <form action="{{ url_for('template_manager.delete_template', template_id=template.id) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this template? This cannot be undone.');">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <button type="submit" class="button danger">Delete</button>
                    </form>
                {% endif %}
            </div>
        </div>
        <div class="template-body">
            {{ template.body|safe }}
        </div>
    </div>
{% endfor %}

{% if not templates %}
    <p>You haven't created any custom templates yet. <a href="{{ url_for('template_manager.new_template_form') }}">Add one now</a> to get started!</p>
{% endif %}

{% endblock %}

